<!-- Header CSS -->
<link href="/css/header.css" rel="stylesheet">
<header class="header">
  <div class="header-container">
    <!-- Enhanced Logo -->
    <a href="/" class="logo">
      <div class="logo-icon">
        <i class="fas fa-rocket"></i>
      </div>
      <div class="logo-text">
        <span class="logo-main">JobLife</span>
        <span class="logo-tagline">Vi·ªác l√†m cho m·ªçi ng∆∞·ªùi</span>
      </div>
    </a>

    <!-- Enhanced Navigation Menu -->
    <nav class="main-nav">
      <ul class="nav-menu">
        <!-- Jobs Mega Dropdown -->
        <li class="nav-item mega-dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-briefcase"></i>
            <span>Vi·ªác L√†m</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="mega-menu">
            <div class="mega-menu-content">
              <div class="mega-menu-section">
                <h4 class="mega-menu-title">
                  <i class="fas fa-search"></i>
                  T√¨m ki·∫øm vi·ªác l√†m
                </h4>
                <div class="mega-menu-links">
                  <a href="/jobs/search-results" class="mega-menu-link">
                    <span class="link-icon">üîç</span>
                    <div class="link-content">
                      <span class="link-title">T√¨m ki·∫øm vi·ªác l√†m</span>
                      <span class="link-desc">Kh√°m ph√° h√†ng ng√†n c∆° h·ªôi</span>
                    </div>
                  </a>
                  <a href="/jobs/search-results?sortBy=date&sortOrder=desc" class="mega-menu-link">
                    <span class="link-icon">üÜï</span>
                    <div class="link-content">
                      <span class="link-title">Vi·ªác l√†m m·ªõi nh·∫•t</span>
                      <span class="link-desc">C·∫≠p nh·∫≠t trong 24h</span>
                    </div>
                  </a>
                  <a href="/jobs/search-results?featured=true" class="mega-menu-link featured">
                    <span class="link-icon">üî•</span>
                    <div class="link-content">
                      <span class="link-title">Vi·ªác l√†m n·ªïi b·∫≠t</span>
                      <span class="link-desc">Top c√¥ng vi·ªác hot nh·∫•t</span>
                    </div>
                    <span class="link-badge">Hot</span>
                  </a>
                  <a href="/jobs/search-results?types=remote" class="mega-menu-link">
                    <span class="link-icon">üè†</span>
                    <div class="link-content">
                      <span class="link-title">L√†m vi·ªác t·ª´ xa</span>
                      <span class="link-desc">Remote & Hybrid</span>
                    </div>
                  </a>
                </div>
              </div>

              <div class="mega-menu-section">
                <h4 class="mega-menu-title">
                  <i class="fas fa-filter"></i>
                  Theo ng√†nh ngh·ªÅ
                </h4>
                <div class="category-grid">
                  <a href="/jobs/it" class="category-item">
                    <span class="category-icon">üíª</span>
                    <span class="category-name">IT & Software</span>
                  </a>
                  <a href="/jobs/marketing" class="category-item">
                    <span class="category-icon">üì±</span>
                    <span class="category-name">Marketing</span>
                  </a>
                  <a href="/jobs/design" class="category-item">
                    <span class="category-icon">üé®</span>
                    <span class="category-name">Design</span>
                  </a>
                  <a href="/jobs/sales" class="category-item">
                    <span class="category-icon">üíº</span>
                    <span class="category-name">Sales</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </li>

        <!-- Companies Dropdown -->
        <li class="nav-item dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-building"></i>
            <span>C√¥ng Ty</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="dropdown-menu">
            <a href="/business/list" class="dropdown-item">
              <span class="item-icon">üìã</span>
              <span class="item-title">Danh s√°ch c√¥ng ty</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/business/register" class="dropdown-item featured">
              <span class="item-icon">‚≠ê</span>
              <span class="item-title">ƒêƒÉng k√Ω nh√† tuy·ªÉn d·ª•ng</span>
              <span class="item-badge">For Business</span>
            </a>
            <a href="/business/login" class="dropdown-item">
              <span class="item-icon">üöÄ</span>
              <span class="item-title">ƒêƒÉng nh·∫≠p tuy·ªÉn d·ª•ng</span>
              <span class="item-arrow">‚Üí</span>
            </a>
          </div>
        </li>

        <!-- Career Tools Dropdown -->
        <li class="nav-item dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-tools"></i>
            <span>C√¥ng c·ª• ngh·ªÅ nghi·ªáp</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="dropdown-menu">
            <a href="/cv/uploadCV" class="dropdown-item">
              <span class="item-icon">üìÑ</span>
              <span class="item-title">T·∫£i CV & G·ª£i √Ω vi·ªác l√†m</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/users/profile" class="dropdown-item">
              <span class="item-icon">üé®</span>
              <span class="item-title">Qu·∫£n l√Ω h·ªì s∆° c√° nh√¢n</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/users/upload-avatar" class="dropdown-item featured">
              <span class="item-icon">üì∏</span>
              <span class="item-title">C·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán</span>
              <span class="item-badge">Profile</span>
            </a>
            <a href="/personality-assessments" class="dropdown-item featured">
              <span class="item-icon">üß†</span>
              <span class="item-title">B√†i ki·ªÉm tra t√≠nh c√°ch</span>
              <span class="item-badge">MBTI, Big Five, DISC</span>
            </a>
            <a href="/jobs/search-results" class="dropdown-item">
              <span class="item-icon">üí∞</span>
              <span class="item-title">T√¨m vi·ªác l∆∞∆°ng cao</span>
              <span class="item-arrow">‚Üí</span>
            </a>
          </div>
        </li>

        <!-- Resources Dropdown -->
        <li class="nav-item dropdown">
          <button class="dropdown-toggle" type="button">
            <i class="fas fa-graduation-cap"></i>
            <span>T√†i nguy√™n</span>
            <i class="fas fa-chevron-down dropdown-indicator"></i>
          </button>
          <div class="dropdown-menu">
            <a href="/" class="dropdown-item">
              <span class="item-icon">üìñ</span>
              <span class="item-title">Trang ch·ªß & Blog</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/auth/register" class="dropdown-item">
              <span class="item-icon">üí°</span>
              <span class="item-title">H∆∞·ªõng d·∫´n ƒëƒÉng k√Ω</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/cv-assistant" class="dropdown-item">
              <span class="item-icon">ü§ñ</span>
              <span class="item-title">CV AI Assistant</span>
              <span class="item-arrow">‚Üí</span>
            </a>
          </div>
        </li>
      </ul>
    </nav>

    <!-- Auth Actions -->
    <div class="auth-actions">
      <!-- User/Business Avatar Icon -->
      <div class="header-avatar-icon">
        {{#if isLogin}}
          {{#if (eq userType 'user')}}
            <!-- Logged in as regular user -->
            <a href="/profile" class="avatar-link">
              {{#if user.avatar}}
                <img src="{{user.avatar}}" alt="{{user.name}}" class="header-avatar" onerror="this.onerror=null; this.src='/images/default-avatar.png';">
              {{else}}
                <div class="avatar-placeholder" style="background-color: {{randomColor user._id}};">
                  {{#if user.name}}
                    {{substring (uppercase user.name) 0 1}}
                  {{else}}
                    <i class="fas fa-user"></i>
                  {{/if}}
                </div>
              {{/if}}
            </a>
          {{else if (eq userType 'business')}}
            <!-- Logged in as business -->
            <a href="/business/dashboard" class="avatar-link">
              {{#if business.logoPath}}
                <img src="{{business.logoPath}}" alt="{{business.companyName}}" class="header-avatar" onerror="this.onerror=null; this.src='/images/default-company.png';">
              {{else}}
                <div class="avatar-placeholder" style="background-color: {{randomColor business._id}};">
                  {{#if business.companyName}}
                    {{substring (uppercase business.companyName) 0 1}}
                  {{else}}
                    <i class="fas fa-building"></i>
                  {{/if}}
                </div>
              {{/if}}
            </a>
          {{/if}}
        {{else}}
          <!-- Not logged in -->
          <a href="/auth/login" class="avatar-link" title="ƒêƒÉng nh·∫≠p">
            <div class="avatar-placeholder" style="background-color: #e2e8f0;">
              <i class="fas fa-user" style="color: #718096;"></i>
            </div>
          </a>
        {{/if}}
      </div>
      
{{#if isLogin}}
  {{#if (eq userType 'user')}}
    <!-- User is logged in - Show avatar with dropdown -->
    <div class="user-dropdown">
            <button class="user-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="User menu">
              <div class="avatar-container">
                {{#if user.avatar}}
                  <img src="{{user.avatar}}" alt="{{user.name}}" class="user-avatar" onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\'avatar-placeholder\' style=\'background-color: {{randomColor user._id}}\'><i class=\'fas fa-user\'></i></div>'">
                {{else}}
                  <div class="avatar-placeholder" style="background-color: {{randomColor user._id}};">
                    {{#if user.name}}
                      {{substring (uppercase user.name) 0 1}}
                    {{else}}
                      <i class="fas fa-user"></i>
                    {{/if}}
                  </div>
                {{/if}}
                {{#if user.isOnline}}
                  <span class="online-status" title="Online"></span>
                {{/if}}
              </div>
              <span class="user-name">{{user.name}}</span>
              <i class="fas fa-chevron-down dropdown-arrow"></i>
            </button>
          <div class="dropdown-menu user-menu" aria-label="User menu">
            <div class="user-menu-header">
              {{#if user.avatar}}
                <img src="{{user.avatar}}" alt="" class="user-menu-avatar" onerror="console.error('Error loading avatar in menu:', this.src); this.onerror=null; this.src='/images/default-avatar.png';">
              {{else}}
                <div class="avatar-placeholder user-menu-avatar" style="background-color: {{randomColor user._id}};">
                  {{#if user.name}}
                    {{substring (uppercase user.name) 0 1}}
                  {{else}}
                    <i class="fas fa-user"></i>
                  {{/if}}
                </div>
              {{/if}}
              <div class="user-menu-info">
                <h4 class="truncate">{{user.name}}</h4>
                <p class="truncate">{{user.email}}</p>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="/users/profile" class="dropdown-item">
              <span class="item-icon">üë§</span>
              <span class="item-title">H·ªì s∆° c√° nh√¢n</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/users/applied-jobs" class="dropdown-item">
              <span class="item-icon">üìã</span>
              <span class="item-title">Vi·ªác l√†m ƒë√£ ·ª©ng tuy·ªÉn</span>
              <span class="item-count">{{user.applicationsCount}}</span>
            </a>
            <a href="/users/saved-jobs" class="dropdown-item">
              <span class="item-icon">‚ù§Ô∏è</span>
              <span class="item-title">Vi·ªác l√†m ƒë√£ l∆∞u</span>
              <span class="item-count">{{user.savedJobsCount}}</span>
            </a>
            <a href="/users/recommendations" class="dropdown-item featured">
              <span class="item-icon">üéØ</span>
              <span class="item-title">G·ª£i √Ω cho b·∫°n</span>
              <span class="item-badge">AI</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="/users/settings" class="dropdown-item">
              <span class="item-icon">‚öôÔ∏è</span>
              <span class="item-title">C√†i ƒë·∫∑t</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/auth/logout" class="dropdown-item logout">
              <span class="item-icon">üö™</span>
              <span class="item-title">ƒêƒÉng xu·∫•t</span>
              <span class="item-arrow">‚Üí</span>
            </a>
      </div>
    </div>
  {{else if business}}
        <!-- Business account is logged in - Show business avatar with dropdown -->
        <div class="user-dropdown">
          <button class="user-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Business menu">
            <div class="avatar-container">
              {{#if business.logoPath}}
                <img src="{{business.logoPath}}" alt="{{business.companyName}}" class="user-avatar" onerror="this.onerror=null; this.src='/images/default-company.png';">
              {{else}}
                <div class="avatar-placeholder" style="background-color: {{randomColor business._id}};">
                  {{#if business.companyName}}
                    {{substring (uppercase business.companyName) 0 1}}
                  {{else}}
                    <i class="fas fa-building"></i>
                  {{/if}}
                </div>
              {{/if}}
            </div>
            <span class="user-name">{{business.companyName}}</span>
            <i class="fas fa-chevron-down dropdown-arrow"></i>
          </button>
          <div class="dropdown-menu user-menu" aria-label="Business menu">
            <div class="user-menu-header">
              {{#if business.logoPath}}
                <img src="{{business.logoPath}}" alt="" class="user-menu-avatar">
              {{else}}
                <div class="avatar-placeholder user-menu-avatar" style="background-color: {{randomColor business._id}};">
                  {{#if business.companyName}}
                    {{substring (uppercase business.companyName) 0 1}}
                  {{else}}
                    <i class="fas fa-building"></i>
                  {{/if}}
                </div>
              {{/if}}
              <div class="user-menu-info">
                <h4 class="truncate">{{business.companyName}}</h4>
                <p class="truncate">{{business.email}}</p>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="/business/dashboard" class="dropdown-item">
              <span class="item-icon">üìä</span>
              <span class="item-title">B·∫£ng ƒëi·ªÅu khi·ªÉn</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/business/jobs" class="dropdown-item">
              <span class="item-icon">üíº</span>
              <span class="item-title">Qu·∫£n l√Ω tin tuy·ªÉn d·ª•ng</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/business/applications" class="dropdown-item">
              <span class="item-icon">üìÑ</span>
              <span class="item-title">H·ªì s∆° ·ª©ng tuy·ªÉn</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="/business/settings" class="dropdown-item">
              <span class="item-icon">‚öôÔ∏è</span>
              <span class="item-title">C√†i ƒë·∫∑t</span>
              <span class="item-arrow">‚Üí</span>
            </a>
            <a href="/auth/logout" class="dropdown-item logout">
              <span class="item-icon">üö™</span>
              <span class="item-title">ƒêƒÉng xu·∫•t</span>
              <span class="item-arrow">‚Üí</span>
            </a>
          </div>
        </div>
      {{/if}}
    {{else}}
        <!-- User is not logged in - Show login/register buttons -->
        <div class="auth-buttons">
          <a href="/auth/login" class="btn btn-login">
            <i class="fas fa-sign-in-alt"></i>
            ƒêƒÉng nh·∫≠p
          </a>
          <a href="/auth/register" class="btn btn-signup">
            <i class="fas fa-user-plus"></i>
            ƒêƒÉng k√Ω
          </a>
        </div>
      {{/if}}
    </div>

    <!-- Enhanced Mobile Menu Toggle -->
    <button class="mobile-menu-toggle">
      <div class="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
  </div>
</header>

<!-- Header Spacer -->
<div class="header-spacer"></div>

<script>
  // Smooth Dropdown Interactions
  document.addEventListener('DOMContentLoaded', function() {
    // Handle dropdown hover with delay for smooth UX
    const navItems = document.querySelectorAll('.nav-item');
    let dropdownTimeout;
    let currentActiveItem = null;

    navItems.forEach(item => {
      item.addEventListener('mouseenter', function() {
        clearTimeout(dropdownTimeout);
        
        // Close previous dropdown immediately
        if (currentActiveItem && currentActiveItem !== this) {
          currentActiveItem.classList.remove('active');
        }
        
        // Add active class for styling
        this.classList.add('active');
        currentActiveItem = this;
      });

      item.addEventListener('mouseleave', function() {
        // Delay removal for smooth transition
        dropdownTimeout = setTimeout(() => {
          if (currentActiveItem === this) {
            this.classList.remove('active');
            currentActiveItem = null;
          }
        }, 200);
      });
    });

    // Handle user dropdown click for mobile
    const userDropdown = document.querySelector('.user-dropdown');
    if (userDropdown) {
      const userToggle = userDropdown.querySelector('.user-menu-toggle');
      if (userToggle) {
        userToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation(); // Prevent event from bubbling up to document
          userDropdown.classList.toggle('active');
          
          // Close other dropdowns
          navItems.forEach(item => {
            if (item !== userDropdown) {
              item.classList.remove('active');
            }
          });
        });
      }
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.nav-item') && !e.target.closest('.user-dropdown')) {
        navItems.forEach(item => item.classList.remove('active'));
        currentActiveItem = null;
        if (userDropdown) {
          userDropdown.classList.remove('active');
        }
      }
    });

    // Smooth scroll for dropdown links
    const dropdownLinks = document.querySelectorAll('.dropdown-item, .mega-menu-link, .category-item');
    dropdownLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        // Add ripple effect
        const ripple = document.createElement('span');
        ripple.style.position = 'absolute';
        ripple.style.borderRadius = '50%';
        ripple.style.background = 'rgba(255, 255, 255, 0.6)';
        ripple.style.width = '20px';
        ripple.style.height = '20px';
        ripple.style.pointerEvents = 'none';
        ripple.style.animation = 'ripple 0.6s ease-out';
        
        const rect = this.getBoundingClientRect();
        ripple.style.left = (e.clientX - rect.left) + 'px';
        ripple.style.top = (e.clientY - rect.top) + 'px';
        
        this.style.position = 'relative';
        this.style.overflow = 'hidden';
        this.appendChild(ripple);
        
        setTimeout(() => ripple.remove(), 600);
      });
    });

    // Add ripple animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes ripple {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);

    // Keyboard navigation for accessibility
    const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
    dropdownToggles.forEach((toggle, index) => {
      toggle.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          this.closest('.nav-item, .user-dropdown').classList.toggle('active');
        }
        if (e.key === 'Escape') {
          this.closest('.nav-item, .user-dropdown').classList.remove('active');
        }
      });
    });
  });
</script> 